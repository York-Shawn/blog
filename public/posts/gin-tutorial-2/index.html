<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title class="pjax-title">Gin-Tutorial-2 - Aya„ÅÆüé∏Room</title><meta name="Description" content="About LoveIt Theme"><meta property="og:title" content="Gin-Tutorial-2" />
<meta property="og:description" content="In this chapter, we gonna make basic module and public module. These module seldom associate with core business, their task is to connect different parts of app, and make app a closed loop." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/gin-tutorial-2/" /><meta property="og:image" content="http://example.org/posts/gin-tutorial-2/featured-image.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-11T03:01:30+08:00" />
<meta property="article:modified_time" content="2021-12-15T03:15:44+08:00" />
<meta property="og:see_also" content="http://example.org/posts/gin-tutorial-1/" /><meta property="og:see_also" content="http://example.org/posts/gin-tutorial-3/" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/posts/gin-tutorial-2/featured-image.jpg"/>
<meta name="twitter:title" content="Gin-Tutorial-2"/>
<meta name="twitter:description" content="In this chapter, we gonna make basic module and public module. These module seldom associate with core business, their task is to connect different parts of app, and make app a closed loop."/>
<meta name="application-name" content="Aya„ÅÆGuitar Room">
<meta name="apple-mobile-web-app-title" content="Aya„ÅÆGuitar Room">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/posts/gin-tutorial-2/" /><link rel="prev" href="http://example.org/posts/gin-tutorial-3/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Gin-Tutorial-2",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/posts\/gin-tutorial-2\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "http:\/\/example.org\/posts\/gin-tutorial-2\/featured-image.jpg",
                            "width":  800 ,
                            "height":  320 
                        }],"genre": "posts","keywords": "Go, Backend","wordcount":  2418 ,
        "url": "http:\/\/example.org\/posts\/gin-tutorial-2\/","datePublished": "2021-03-11T03:01:30+08:00","dateModified": "2021-12-15T03:15:44+08:00","publisher": {
            "@type": "Organization",
            "name": "Aya"},"author": {
                "@type": "Person",
                "name": "Aya"
            },"description": ""
    }
    </script></head>

<body header-desktop="fix" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme);}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Aya„ÅÆüé∏Room"><span class="header-title-pre"><i class="fas fa-code"></i></span><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/series/"> Series </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/York-Shawn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" onclick="return false;" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Aya„ÅÆüé∏Room"><span class="header-title-pre"><i class="fas fa-code"></i></span><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" onclick="return false;" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/series/" title="">Series</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/York-Shawn" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="#" onclick="return false;" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content always-active" id="toc-content-auto"></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Gin-Tutorial-2</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="/" title="Author" rel=" author" class="author">Aya</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/documentation/"><i class="far fa-folder fa-fw"></i>Documentation</a></span>&nbsp;<span class="post-category">and</span>&nbsp;<span class="post-series">series <a href="/series/gin-tutorial/"><i class="far fa-list-alt fa-fw"></i>Gin Tutorial</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-03-11">2021-03-11</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2021-12-15">2021-12-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2418 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;<span>
                        <i class="fas fa-balance-scale fa-fw"></i>&nbsp;<span><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>&nbsp;
                    </span>&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        data-src="/posts/gin-tutorial-2/featured-image.jpg"
        data-srcset="/posts/gin-tutorial-2/featured-image.jpg, /posts/gin-tutorial-2/featured-image.jpg 1.5x, /posts/gin-tutorial-2/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/posts/gin-tutorial-2/featured-image.jpg"
        title="/posts/gin-tutorial-2/featured-image.jpg" height="320" width="800"
    /></div>
                    
                        
                        <div class="details series-nav open">
                            <div class="details-summary series-title">
                                <span>Series - Gin Tutorial</span>
                                <span><i class="details-icon fas fa-angle-right"></i></span>
                            </div>
                            <div class="details-content series-content">
                                <nav>
                                    <ul>
                                        
                                            
                                                <li><a href="/posts/gin-tutorial-1/">Gin-Tutorial-1</a></li>
                                            
                                        
                                            
                                                <li><span class="active">Gin-Tutorial-2</span></li>
                                            
                                        
                                            
                                                <li><a href="/posts/gin-tutorial-3/">Gin-Tutorial-3</a></li>
                                            
                                        
                                    </ul>
                                </nav>
                            </div>
                        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-standerlized-errorcode">1. Standerlized ErrorCode</a>
      <ul>
        <li><a href="#11-common-errcode">1.1 common errcode</a></li>
        <li><a href="#12-error-handler">1.2 error handler</a>
          <ul>
            <li><a href="#errcodego">errcode.go</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-configuration-management">2. Configuration Management</a>
      <ul>
        <li><a href="#21-configuration-file">2.1 configuration file</a>
          <ul>
            <li><a href="#configsyaml">configs.yaml</a></li>
          </ul>
        </li>
        <li><a href="#22-write-component">2.2 write component</a>
          <ul>
            <li><a href="#settinggo">setting.go</a></li>
            <li><a href="#sectiongo">section.go</a></li>
          </ul>
        </li>
        <li><a href="#23-package-gloabl-variable">2.3 package gloabl variable</a>
          <ul>
            <li><a href="#settinggo-1">setting.go</a></li>
          </ul>
        </li>
        <li><a href="#24-initialize-reading-conf">2.4 initialize reading conf</a>
          <ul>
            <li><a href="#maingo">main.go</a></li>
          </ul>
        </li>
        <li><a href="#25-modify-server-conf">2.5 modify server conf</a></li>
      </ul>
    </li>
    <li><a href="#3-database-connection">3. DataBase Connection</a>
      <ul>
        <li><a href="#31-component">3.1 component</a>
          <ul>
            <li><a href="#modelgo">model.go</a></li>
          </ul>
        </li>
        <li><a href="#32-package-global-variable">3.2 package global variable</a>
          <ul>
            <li><a href="#dbgo">db.go</a></li>
          </ul>
        </li>
        <li><a href="#33-initialization">3.3 initialization</a>
          <ul>
            <li><a href="#maingo-1">main.go</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-log">4. Log</a>
      <ul>
        <li><a href="#41-log-classification">4.1 log classification</a>
          <ul>
            <li><a href="#loggergo">logger.go</a></li>
          </ul>
        </li>
        <li><a href="#42-log-standardization">4.2 log standardization</a>
          <ul>
            <li><a href="#loggergo-1">logger.go</a></li>
          </ul>
        </li>
        <li><a href="#43-log-formatting--output">4.3 log formatting &amp; output</a>
          <ul>
            <li><a href="#loggergo-2">logger.go</a></li>
          </ul>
        </li>
        <li><a href="#44-log-classified-output">4.4 log classified output</a>
          <ul>
            <li><a href="#loggergo-3">logger.go</a></li>
          </ul>
        </li>
        <li><a href="#45-package-global-variable">4.5 package global variable</a>
          <ul>
            <li><a href="#settinggo-2">setting.go</a></li>
          </ul>
        </li>
        <li><a href="#46-initialization">4.6 initialization</a></li>
      </ul>
    </li>
    <li><a href="#5-response-handling">5. Response Handling</a>
      <ul>
        <li><a href="#51-type-converting">5.1 type converting</a>
          <ul>
            <li><a href="#convertgo">convert.go</a></li>
          </ul>
        </li>
        <li><a href="#52-paging-handling">5.2 paging handling</a>
          <ul>
            <li><a href="#paginationgo">pagination.go</a></li>
          </ul>
        </li>
        <li><a href="#53-response-handling">5.3 response handling</a>
          <ul>
            <li><a href="#appgo">app.go</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>In this chapter, we gonna make basic module and public module. These module seldom associate with core business, their task is to connect different parts of app, and make app a closed loop.</p>
<h2 id="1-standerlized-errorcode">1. Standerlized ErrorCode</h2>
<h3 id="11-common-errcode">1.1 common errcode</h3>
<p>predefine common errcode in <code>pkg/errcode</code> to guide users</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">var</span> <span class="p">(</span>
	<span class="nx">Success</span>                   <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#34;ÊàêÂäü&#34;</span><span class="p">)</span>
	<span class="nx">ServerError</span>               <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="s">&#34;ÊúçÂä°ÂÜÖÈÉ®ÈîôËØØ&#34;</span><span class="p">)</span>
	<span class="nx">InvalidParams</span>             <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000001</span><span class="p">,</span> <span class="s">&#34;ÂÖ•ÂèÇÈîôËØØ&#34;</span><span class="p">)</span>
	<span class="nx">NotFound</span>                  <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000002</span><span class="p">,</span> <span class="s">&#34;Êâæ‰∏çÂà∞&#34;</span><span class="p">)</span>
	<span class="nx">UnauthorizedAuthNotExist</span>  <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000003</span><span class="p">,</span> <span class="s">&#34;Èâ¥ÊùÉÂ§±Ë¥•ÔºåÊâæ‰∏çÂà∞ÂØπÂ∫îÁöÑ AppKey Âíå AppSecret&#34;</span><span class="p">)</span>
	<span class="nx">UnauthorizedTokenError</span>    <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000004</span><span class="p">,</span> <span class="s">&#34;Èâ¥ÊùÉÂ§±Ë¥•ÔºåToken ÈîôËØØ&#34;</span><span class="p">)</span>
	<span class="nx">UnauthorizedTokenTimeout</span>  <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000005</span><span class="p">,</span> <span class="s">&#34;Èâ¥ÊùÉÂ§±Ë¥•ÔºåToken Ë∂ÖÊó∂&#34;</span><span class="p">)</span>
	<span class="nx">UnauthorizedTokenGenerate</span> <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000006</span><span class="p">,</span> <span class="s">&#34;Èâ¥ÊùÉÂ§±Ë¥•ÔºåToken ÁîüÊàêÂ§±Ë¥•&#34;</span><span class="p">)</span>
	<span class="nx">TooManyRequests</span>           <span class="p">=</span> <span class="nf">NewError</span><span class="p">(</span><span class="mi">10000007</span><span class="p">,</span> <span class="s">&#34;ËØ∑Ê±ÇËøáÂ§ö&#34;</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="12-error-handler">1.2 error handler</h3>
<p>create errcode.go in <code>pkg/errcode</code>, write some public methods od error handling to standerlized our error output.</p>
<h4 id="errcodego">errcode.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">Error</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">code</span> <span class="kt">int</span> <span class="s">`json:&#34;code&#34;`</span>
	<span class="nx">msg</span> <span class="kt">string</span> <span class="s">`json:&#34;msg&#34;`</span>
	<span class="nx">details</span> <span class="p">[]</span><span class="kt">string</span> <span class="s">`json:&#34;details&#34;`</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">codes</span> <span class="p">=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nf">NewError</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Error</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">codes</span><span class="p">[</span><span class="nx">code</span><span class="p">];</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="nb">panic</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;ÈîôËØØÁ†Å %d Â∑≤ÁªèÂ≠òÂú®ÔºåËØ∑Êõ¥Êç¢‰∏Ä‰∏™&#34;</span><span class="p">,</span> <span class="nx">code</span><span class="p">))</span>
	<span class="p">}</span>
	<span class="nx">codes</span><span class="p">[</span><span class="nx">code</span><span class="p">]</span> <span class="p">=</span> <span class="nx">msg</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Error</span><span class="p">{</span><span class="nx">code</span><span class="p">:</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">msg</span><span class="p">:</span> <span class="nx">msg</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;ÈîôËØØÁ†ÅÔºö%d, ÈîôËØØ‰ø°ÊÅØ:Ôºö%s&#34;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Code</span><span class="p">(),</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Msg</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">Code</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">code</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">Msg</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">msg</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">Msgf</span><span class="p">(</span><span class="nx">args</span> <span class="p">[]</span><span class="kd">interface</span><span class="p">{})</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">Details</span><span class="p">()</span> <span class="p">[]</span><span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">details</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">WithDetails</span><span class="p">(</span><span class="nx">details</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Error</span> <span class="p">{</span>
	<span class="nx">newError</span> <span class="o">:=</span> <span class="o">*</span><span class="nx">e</span>
	<span class="nx">newError</span><span class="p">.</span><span class="nx">details</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">d</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">details</span> <span class="p">{</span>
		<span class="nx">newError</span><span class="p">.</span><span class="nx">details</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">newError</span><span class="p">.</span><span class="nx">details</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">newError</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Error</span><span class="p">)</span> <span class="nf">StatusCode</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nf">Code</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nx">Success</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span>
	<span class="k">case</span> <span class="nx">ServerError</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span>
	<span class="k">case</span> <span class="nx">InvalidParams</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusBadRequest</span>
	<span class="k">case</span> <span class="nx">UnauthorizedAuthNotExist</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">fallthrough</span>
	<span class="k">case</span> <span class="nx">UnauthorizedTokenError</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">fallthrough</span>
	<span class="k">case</span> <span class="nx">UnauthorizedTokenGenerate</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">fallthrough</span>
	<span class="k">case</span> <span class="nx">UnauthorizedTokenTimeout</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusUnauthorized</span>
	<span class="k">case</span> <span class="nx">TooManyRequests</span><span class="p">.</span><span class="nf">Code</span><span class="p">():</span>
		<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusTooManyRequests</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">http</span><span class="p">.</span><span class="nx">StatusInternalServerError</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>in the <code>common_code.go</code> we use <strong>NewError</strong> method to create Error structure as the response towards error. <code>codes</code> is the carrier of global errcode.</p>
<p><strong>StatusCod</strong> method is used for StatusCode transformation of specific errcode, given a Error and match its Code to common error and return the matched one.</p>
<h2 id="2-configuration-management">2. Configuration Management</h2>
<p>use third party lib <code>viper</code> to manage conf</p>
<pre><code>go get -u github.com/spf13/viper
</code></pre>
<h3 id="21-configuration-file">2.1 configuration file</h3>
<p>create config.yaml in <code>configs</code></p>
<h4 id="configsyaml">configs.yaml</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">Server</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">RunMode</span><span class="p">:</span><span class="w"> </span><span class="l">debug</span><span class="w">
</span><span class="w">  </span><span class="nt">HttpPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">  </span><span class="nt">ReadTimeout</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span><span class="w">  </span><span class="nt">WriteTimeout</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span><span class="w"></span><span class="nt">App</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">DefaultPageSize</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">  </span><span class="nt">MaxPageSize</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="w">  </span><span class="nt">LogSavePath</span><span class="p">:</span><span class="w"> </span><span class="l">storage/logs</span><span class="w">
</span><span class="w">  </span><span class="nt">LogFileName</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span><span class="w">  </span><span class="nt">LogFileExt</span><span class="p">:</span><span class="w"> </span><span class="l">.log</span><span class="w">
</span><span class="w"></span><span class="nt">Database</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">DBType</span><span class="p">:</span><span class="w"> </span><span class="l">mysql</span><span class="w">
</span><span class="w">  </span><span class="nt">Username</span><span class="p">:</span><span class="w"> </span><span class="l">root </span><span class="w"> </span><span class="c"># your own db username</span><span class="w">
</span><span class="w">  </span><span class="nt">Password</span><span class="p">:</span><span class="w"> </span><span class="l">rootroot </span><span class="w"> </span><span class="c"># your own db passwd</span><span class="w">
</span><span class="w">  </span><span class="nt">Host</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="p">:</span><span class="m">3306</span><span class="w">
</span><span class="w">  </span><span class="nt">DBName</span><span class="p">:</span><span class="w"> </span><span class="l">blog_service</span><span class="w">
</span><span class="w">  </span><span class="nt">TablePrefix</span><span class="p">:</span><span class="w"> </span><span class="l">blog_</span><span class="w">
</span><span class="w">  </span><span class="nt">Charset</span><span class="p">:</span><span class="w"> </span><span class="l">utf8</span><span class="w">
</span><span class="w">  </span><span class="nt">ParseTime</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span><span class="w">  </span><span class="nt">MaxIdleConns</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span><span class="w">  </span><span class="nt">MaxOpenConns</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>in the configuration, we set the default settings for:</p>
<ul>
<li>Server: server conf, gin&rsquo;s RunMode, default HTTP listening port, maximum read and write time</li>
<li>APP: Application conf, default page size, maximum page size and default log save path</li>
<li>Database: Database conf, required parameters of connecting to db instance</li>
</ul>
<h3 id="22-write-component">2.2 write component</h3>
<p>after configuration file, encapsulate the method of reading conf. create setting.go in <code>pkg/setting</code></p>
<h4 id="settinggo">setting.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">Setting</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">vp</span> <span class="o">*</span><span class="nx">viper</span><span class="p">.</span><span class="nx">Viper</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewSetting</span><span class="p">()</span> <span class="p">(</span><span class="o">*</span><span class="nx">Setting</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">vp</span> <span class="o">:=</span> <span class="nx">viper</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">vp</span><span class="p">.</span><span class="nf">SetConfigName</span><span class="p">(</span><span class="s">&#34;config&#34;</span><span class="p">)</span>
	<span class="nx">vp</span><span class="p">.</span><span class="nf">AddConfigPath</span><span class="p">(</span><span class="s">&#34;configs/&#34;</span><span class="p">)</span>
	<span class="nx">vp</span><span class="p">.</span><span class="nf">SetConfigType</span><span class="p">(</span><span class="s">&#34;yaml&#34;</span><span class="p">)</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">vp</span><span class="p">.</span><span class="nf">ReadInConfig</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Setting</span><span class="p">{</span><span class="nx">vp</span><span class="p">},</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>NewSetting</code> to initialize basic attribute of project&rsquo;s configuration.Set config file name as <code>config</code>, type as <code>yaml</code>, and config file path as <code>configs/</code></p>
<p>Next we gonna create section.go in the same dir to declare the module of conf attribute and write methods to read setting in sections.</p>
<h4 id="sectiongo">section.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">ServerSettingS</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">RunMode</span>      <span class="kt">string</span>
	<span class="nx">HttpPort</span>     <span class="kt">string</span>
	<span class="nx">ReadTimeout</span>  <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
	<span class="nx">WriteTimeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">AppSettingS</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">DefaultPageSize</span> <span class="kt">int</span>
	<span class="nx">MaxPageSize</span>     <span class="kt">int</span>
	<span class="nx">LogSavePath</span>     <span class="kt">string</span>
	<span class="nx">LogFileName</span>     <span class="kt">string</span>
	<span class="nx">LogFileExt</span>      <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">DatabaseSettingS</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">DBType</span>       <span class="kt">string</span>
	<span class="nx">UserName</span>     <span class="kt">string</span>
	<span class="nx">Password</span>     <span class="kt">string</span>
	<span class="nx">Host</span>         <span class="kt">string</span>
	<span class="nx">DBName</span>       <span class="kt">string</span>
	<span class="nx">TablePrefix</span>  <span class="kt">string</span>
	<span class="nx">Charset</span>      <span class="kt">string</span>
	<span class="nx">ParseTime</span>    <span class="kt">bool</span>
	<span class="nx">MaxIdleConns</span> <span class="kt">int</span>
	<span class="nx">MaxOpenConns</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Setting</span><span class="p">)</span> <span class="nf">ReadSection</span><span class="p">(</span><span class="nx">k</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{})</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">vp</span><span class="p">.</span><span class="nf">UnmarshalKey</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="23-package-gloabl-variable">2.3 package gloabl variable</h3>
<p>To connect the conf and app, we should create global variable for us to use them.<br>
setting.go in <code>global/</code></p>
<h4 id="settinggo-1">setting.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">var</span> <span class="p">(</span>
	<span class="nx">ServerSetting</span>   <span class="o">*</span><span class="nx">setting</span><span class="p">.</span><span class="nx">ServerSettingS</span>
	<span class="nx">AppSetting</span>      <span class="o">*</span><span class="nx">setting</span><span class="p">.</span><span class="nx">AppSettingS</span>
	<span class="nx">DatabaseSetting</span> <span class="o">*</span><span class="nx">setting</span><span class="p">.</span><span class="nx">DatabaseSettingS</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="24-initialize-reading-conf">2.4 initialize reading conf</h3>
<p>back to main.go</p>
<h4 id="maingo">main.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nf">setupSetting</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;init.setupSetting err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">setupSetting</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">setting</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">setting</span><span class="p">.</span><span class="nf">NewSetting</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">setting</span><span class="p">.</span><span class="nf">ReadSection</span><span class="p">(</span><span class="s">&#34;Server&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">setting</span><span class="p">.</span><span class="nf">ReadSection</span><span class="p">(</span><span class="s">&#34;App&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nx">setting</span><span class="p">.</span><span class="nf">ReadSection</span><span class="p">(</span><span class="s">&#34;Database&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">global</span><span class="p">.</span><span class="nx">DatabaseSetting</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">ReadTimeout</span> <span class="o">*=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
	<span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">WriteTimeout</span> <span class="o">*=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>init</code> is used for initialize process in app, and is run automatically.<br>
Order is : init global variable =&gt; init method =&gt; main method</p>
<h3 id="25-modify-server-conf">2.5 modify server conf</h3>
<p>all we need to do is to set the conf and RunMode of gin in <code>main.go</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">gin</span><span class="p">.</span><span class="nf">SetMode</span><span class="p">(</span><span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">RunMode</span><span class="p">)</span>
	<span class="nx">router</span> <span class="o">:=</span> <span class="nx">routers</span><span class="p">.</span><span class="nf">NewRouter</span><span class="p">()</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Server</span><span class="p">{</span>
		<span class="nx">Addr</span><span class="p">:</span>           <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">HttpPort</span><span class="p">,</span>
		<span class="nx">Handler</span><span class="p">:</span>        <span class="nx">router</span><span class="p">,</span>
		<span class="nx">ReadTimeout</span><span class="p">:</span>    <span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">ReadTimeout</span><span class="p">,</span>
		<span class="nx">WriteTimeout</span><span class="p">:</span>   <span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">WriteTimeout</span><span class="p">,</span>
		<span class="nx">MaxHeaderBytes</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">s</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="3-database-connection">3. DataBase Connection</h2>
<p>use third party lib <strong>gorm</strong></p>
<pre><code>go get -u github.com/jinzhu/gorm
</code></pre>
<h3 id="31-component">3.1 component</h3>
<p>add <strong>NewDBEngine</strong> method to <em>model.go</em> under <code>internal/model/</code></p>
<h4 id="modelgo">model.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">Model</span> <span class="kd">struct</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewDBEngine</span><span class="p">(</span><span class="nx">databaseSetting</span> <span class="o">*</span><span class="nx">setting</span><span class="p">.</span><span class="nx">DatabaseSettingS</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">gorm</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">DBType</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s:%s@tcp(%s)/%s?charset=%s&amp;parseTime=%t&amp;loc=Local&#34;</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">UserName</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">Password</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">DBName</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">Charset</span><span class="p">,</span>
		<span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">ParseTime</span><span class="p">,</span>
	<span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="nx">global</span><span class="p">.</span><span class="nx">ServerSetting</span><span class="p">.</span><span class="nx">RunMode</span> <span class="o">==</span> <span class="s">&#34;debug&#34;</span> <span class="p">{</span>
		<span class="nx">db</span><span class="p">.</span><span class="nf">LogMode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">SingularTable</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">DB</span><span class="p">().</span><span class="nf">SetMaxIdleConns</span><span class="p">(</span><span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">MaxIdleConns</span><span class="p">)</span>
	<span class="nx">db</span><span class="p">.</span><span class="nf">DB</span><span class="p">().</span><span class="nf">SetMaxOpenConns</span><span class="p">(</span><span class="nx">databaseSetting</span><span class="p">.</span><span class="nx">MaxOpenConns</span><span class="p">)</span>

	<span class="k">return</span> <span class="nx">db</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>NewDBEngine</strong> create a DB instance, and add the import of <code>gorm</code> and initialize MySQL driver lib <code>github.com/jinzhu/gorm/dialects/mysql</code></p>
<h3 id="32-package-global-variable">3.2 package global variable</h3>
<p>create db.go in <code>global</code></p>
<h4 id="dbgo">db.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">var</span> <span class="p">(</span>
    <span class="nx">DBEngine</span> <span class="o">*</span><span class="nx">gorm</span><span class="p">.</span><span class="nx">DB</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="33-initialization">3.3 initialization</h3>
<p>add method <strong>setupDBEngine</strong> to main.go</p>
<h4 id="maingo-1">main.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="o">...</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nf">setupDBEngine</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;init.setupDBEngine err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">func</span> <span class="nf">setupSetting</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">func</span> <span class="nf">setupLogger</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">setupDBEngine</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
	<span class="nx">global</span><span class="p">.</span><span class="nx">DBEngine</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">model</span><span class="p">.</span><span class="nf">NewDBEngine</span><span class="p">(</span><span class="nx">global</span><span class="p">.</span><span class="nx">DatabaseSetting</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="4-log">4. Log</h2>
<pre><code>go get -u gopkg.in/natefinch/lumberjack.v2
</code></pre>
<h3 id="41-log-classification">4.1 log classification</h3>
<p>create logger.go in <code>pkg/logger/</code></p>
<h4 id="loggergo">logger.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">Level</span> <span class="kt">int8</span>

<span class="kd">type</span> <span class="nx">Fields</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span>

<span class="kd">const</span> <span class="p">(</span>
	<span class="nx">LevelDebug</span> <span class="nx">Level</span> <span class="p">=</span> <span class="kc">iota</span>
	<span class="nx">LevelInfo</span>
	<span class="nx">LevelWarn</span>
	<span class="nx">LevelError</span>
	<span class="nx">LevelFatal</span>
	<span class="nx">LevelPanic</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="nx">Level</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="nx">l</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nx">LevelDebug</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;debug&#34;</span>
	<span class="k">case</span> <span class="nx">LevelInfo</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;info&#34;</span>
	<span class="k">case</span> <span class="nx">LevelWarn</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;warn&#34;</span>
	<span class="k">case</span> <span class="nx">LevelError</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;error&#34;</span>
	<span class="k">case</span> <span class="nx">LevelFatal</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;fatal&#34;</span>
	<span class="k">case</span> <span class="nx">LevelPanic</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#34;panic&#34;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We predefine the specific types of Level and Fields in app log, and categorize into Debug, Info, Warn, Error, Fatal, Panic.</p>
<h3 id="42-log-standardization">4.2 log standardization</h3>
<p>After categorize method, we shall work on methods for initialization of instance and standardized parameter binding</p>
<h4 id="loggergo-1">logger.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">type</span> <span class="nx">Logger</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">newLogger</span> <span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
	<span class="nx">ctx</span>       <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span>
	<span class="nx">fields</span>    <span class="nx">Fields</span>
	<span class="nx">callers</span>   <span class="p">[]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewLogger</span><span class="p">(</span><span class="nx">w</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">,</span> <span class="nx">prefix</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">flag</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">l</span> <span class="o">:=</span> <span class="nx">log</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">flag</span><span class="p">)</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Logger</span><span class="p">{</span><span class="nx">newLogger</span><span class="p">:</span> <span class="nx">l</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">clone</span><span class="p">()</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">nl</span> <span class="o">:=</span> <span class="o">*</span><span class="nx">l</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">nl</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">WithFields</span><span class="p">(</span><span class="nx">f</span> <span class="nx">Fields</span><span class="p">)</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">ll</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">ll</span><span class="p">.</span><span class="nx">fields</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">ll</span><span class="p">.</span><span class="nx">fields</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Fields</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">f</span> <span class="p">{</span>
		<span class="nx">ll</span><span class="p">.</span><span class="nx">fields</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ll</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">WithContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">ll</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>
	<span class="nx">ll</span><span class="p">.</span><span class="nx">ctx</span> <span class="p">=</span> <span class="nx">ctx</span>
	<span class="k">return</span> <span class="nx">ll</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">WithCaller</span><span class="p">(</span><span class="nx">skip</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">ll</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>
	<span class="nx">pc</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">Caller</span><span class="p">(</span><span class="nx">skip</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
		<span class="nx">f</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">FuncForPC</span><span class="p">(</span><span class="nx">pc</span><span class="p">)</span>
		<span class="nx">ll</span><span class="p">.</span><span class="nx">callers</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s: %d %s&#34;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nf">Name</span><span class="p">())}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">ll</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">WithCallersFrames</span><span class="p">()</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="nx">maxCallerDepth</span> <span class="o">:=</span> <span class="mi">25</span>
	<span class="nx">minCallerDepth</span> <span class="o">:=</span> <span class="mi">1</span>
	<span class="nx">callers</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
	<span class="nx">pcs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">uintptr</span><span class="p">,</span> <span class="nx">maxCallerDepth</span><span class="p">)</span>
	<span class="nx">depth</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">Callers</span><span class="p">(</span><span class="nx">minCallerDepth</span><span class="p">,</span> <span class="nx">pcs</span><span class="p">)</span>
	<span class="nx">frames</span> <span class="o">:=</span> <span class="nx">runtime</span><span class="p">.</span><span class="nf">CallersFrames</span><span class="p">(</span><span class="nx">pcs</span><span class="p">[:</span><span class="nx">depth</span><span class="p">])</span>
	<span class="k">for</span> <span class="nx">frame</span><span class="p">,</span> <span class="nx">more</span> <span class="o">:=</span> <span class="nx">frames</span><span class="p">.</span><span class="nf">Next</span><span class="p">();</span> <span class="nx">more</span><span class="p">;</span> <span class="nx">frame</span><span class="p">,</span> <span class="nx">more</span> <span class="p">=</span> <span class="nx">frames</span><span class="p">.</span><span class="nf">Next</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">callers</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">callers</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s: %d %s&#34;</span><span class="p">,</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">Line</span><span class="p">,</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">Function</span><span class="p">))</span>
		<span class="k">if</span> <span class="p">!</span><span class="nx">more</span> <span class="p">{</span>
			<span class="k">break</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">ll</span> <span class="o">:=</span> <span class="nx">l</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>
	<span class="nx">ll</span><span class="p">.</span><span class="nx">callers</span> <span class="p">=</span> <span class="nx">callers</span>
	<span class="k">return</span> <span class="nx">ll</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>WithLevel: Set log level<br>
WithFields: Set log public fields
WithContext: Set log context attribute
WithCaller: Set one caller&rsquo;s information
WithCallerFrames: Set all caller&rsquo;s information</p>
<h3 id="43-log-formatting--output">4.3 log formatting &amp; output</h3>
<h4 id="loggergo-2">logger.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">JSONFormat</span><span class="p">(</span><span class="nx">level</span> <span class="nx">Level</span><span class="p">,</span> <span class="nx">message</span> <span class="kt">string</span><span class="p">)</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
	<span class="nx">data</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Fields</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">fields</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
	<span class="nx">data</span><span class="p">[</span><span class="s">&#34;level&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">level</span><span class="p">.</span><span class="nf">String</span><span class="p">()</span>
	<span class="nx">data</span><span class="p">[</span><span class="s">&#34;time&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Local</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()</span>
	<span class="nx">data</span><span class="p">[</span><span class="s">&#34;message&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">message</span>
	<span class="nx">data</span><span class="p">[</span><span class="s">&#34;callers&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">callers</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">fields</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">l</span><span class="p">.</span><span class="nx">fields</span> <span class="p">{</span>
			<span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span> <span class="p">!</span><span class="nx">ok</span> <span class="p">{</span>
				<span class="nx">data</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">data</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">Output</span><span class="p">(</span><span class="nx">level</span> <span class="nx">Level</span><span class="p">,</span> <span class="nx">message</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">body</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nf">JSONFormat</span><span class="p">(</span><span class="nx">level</span><span class="p">,</span> <span class="nx">message</span><span class="p">))</span>
	<span class="nx">content</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span>
	<span class="k">switch</span> <span class="nx">level</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nx">LevelDebug</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="k">case</span> <span class="nx">LevelInfo</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="k">case</span> <span class="nx">LevelWarn</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="k">case</span> <span class="nx">LevelError</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="k">case</span> <span class="nx">LevelFatal</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="k">case</span> <span class="nx">LevelPanic</span><span class="p">:</span>
		<span class="nx">l</span><span class="p">.</span><span class="nx">newLogger</span><span class="p">.</span><span class="nf">Panic</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="44-log-classified-output">4.4 log classified output</h3>
<h4 id="loggergo-3">logger.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">Info</span><span class="p">(</span><span class="nx">v</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">l</span><span class="p">.</span><span class="nf">Output</span><span class="p">(</span><span class="nx">LevelInfo</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprint</span><span class="p">(</span><span class="nx">v</span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">Infof</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">v</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">l</span><span class="p">.</span><span class="nf">Output</span><span class="p">(</span><span class="nx">LevelInfo</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">v</span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">Fatal</span><span class="p">(</span><span class="nx">v</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">l</span><span class="p">.</span><span class="nf">Output</span><span class="p">(</span><span class="nx">LevelFatal</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprint</span><span class="p">(</span><span class="nx">v</span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">l</span> <span class="o">*</span><span class="nx">Logger</span><span class="p">)</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">v</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">l</span><span class="p">.</span><span class="nf">Output</span><span class="p">(</span><span class="nx">LevelFatal</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">v</span><span class="o">...</span><span class="p">))</span>
<span class="p">}</span>

<span class="o">...</span>
</code></pre></td></tr></table>
</div>
</div><p>code above just shows <strong>info</strong> and <strong>Fatal</strong> output, other level code is no difference but the name and Withlevel.</p>
<h3 id="45-package-global-variable">4.5 package global variable</h3>
<p>after we finish the logger, we need to define a <strong>Logger</strong> object for our app to use. So, we open the <code>global/setting.go</code> file, add following contents.</p>
<h4 id="settinggo-2">setting.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">var</span> <span class="p">(</span>
	<span class="o">...</span>
	<span class="nx">Logger</span>	<span class="o">*</span><span class="nx">logger</span><span class="p">.</span><span class="nx">Logger</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="46-initialization">4.6 initialization</h3>
<p>next, we should modify the <code>main.go</code> in the root directory, add on initialization for the Logger object we just defined</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nf">setupSetting</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;init.setupSetting err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">err</span> <span class="p">=</span> <span class="nf">setupLogger</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;init.setupLogger err: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="kd">func</span> <span class="nf">setupSetting</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">setupLogger</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">global</span><span class="p">.</span><span class="nx">Logger</span> <span class="p">=</span> <span class="nx">logger</span><span class="p">.</span><span class="nf">NewLogger</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lumberjack</span><span class="p">.</span><span class="nx">Logger</span><span class="p">{</span>
		<span class="nx">Filename</span><span class="p">:</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">LogSavePath</span> <span class="o">+</span> <span class="s">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">LogFileName</span> <span class="o">+</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">LogFileExt</span><span class="p">,</span>
		<span class="nx">MaxSize</span><span class="p">:</span>   <span class="mi">600</span><span class="p">,</span>
		<span class="nx">MaxAge</span><span class="p">:</span>    <span class="mi">10</span><span class="p">,</span>
		<span class="nx">LocalTime</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="p">},</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nx">log</span><span class="p">.</span><span class="nx">LstdFlags</span><span class="p">).</span><span class="nf">WithCaller</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>we add logger component through this file, and initialize the global variable <code>Logger</code> inside method <code>setupLogger</code>. Being aware that we use <code>lumberjack</code> as logger&rsquo;s <strong>io.writer</strong>.</p>
<h2 id="5-response-handling">5. Response Handling</h2>
<p>In application, port from server bond to client, then how do server know know the result of interface call. Generally speaking, it depends on the HTTP status code and response the interface returned, and the judgement is based on the response results defined in advance according to the specification.</p>
<p>Therefore in this subsection we&rsquo;ll write the response handling method returned by the Unified Processing Interface, which also correspond to error code standardization.</p>
<h3 id="51-type-converting">5.1 type converting</h3>
<p>create <em>convert.go</em> under <code>pkg/convert</code></p>
<h4 id="convertgo">convert.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">StrTo</span> <span class="kt">string</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">StrTo</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nb">string</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">StrTo</span><span class="p">)</span> <span class="nf">Int</span><span class="p">()</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
	<span class="k">return</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">StrTo</span><span class="p">)</span> <span class="nf">MustInt</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Int</span><span class="p">()</span>
	<span class="k">return</span> <span class="nx">v</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">StrTo</span><span class="p">)</span> <span class="nf">UInt32</span><span class="p">()</span> <span class="p">(</span><span class="kt">uint32</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">Atoi</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
	<span class="k">return</span> <span class="nb">uint32</span><span class="p">(</span><span class="nx">v</span><span class="p">),</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="nx">StrTo</span><span class="p">)</span> <span class="nf">MustUInt32</span><span class="p">()</span> <span class="kt">uint32</span> <span class="p">{</span>
	<span class="nx">v</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">UInt32</span><span class="p">()</span>
	<span class="k">return</span> <span class="nx">v</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="52-paging-handling">5.2 paging handling</h3>
<p>create <em>pagination.go</em> under <code>pkg/app</code></p>
<h4 id="paginationgo">pagination.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">GetPage</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">page</span> <span class="o">:=</span> <span class="nx">convert</span><span class="p">.</span><span class="nf">StrTo</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;page&#34;</span><span class="p">)).</span><span class="nf">MustInt</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">page</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">1</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">page</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetPageSize</span><span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">pageSize</span> <span class="o">:=</span> <span class="nx">convert</span><span class="p">.</span><span class="nf">StrTo</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s">&#34;page_size&#34;</span><span class="p">)).</span><span class="nf">MustInt</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">pageSize</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">DefaultPageSize</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">pageSize</span> <span class="p">&gt;</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">MaxPageSize</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">global</span><span class="p">.</span><span class="nx">AppSetting</span><span class="p">.</span><span class="nx">MaxPageSize</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">pageSize</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">GetPageOffset</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">pageSize</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="nx">result</span> <span class="o">:=</span> <span class="mi">0</span>
	<span class="k">if</span> <span class="nx">page</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">result</span> <span class="p">=</span> <span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">pageSize</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">result</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="53-response-handling">5.3 response handling</h3>
<p>create <em>app.go</em> under <code>pkg/app</code></p>
<h4 id="appgo">app.go</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Response</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Pager</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Page</span> <span class="kt">int</span> <span class="s">`json:&#34;page&#34;`</span>
	<span class="nx">PageSize</span> <span class="kt">int</span> <span class="s">`json:&#34;page_size&#34;`</span>
	<span class="nx">TotalRows</span> <span class="kt">int</span> <span class="s">`json:&#34;total_rows&#34;`</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewResponse</span><span class="p">(</span><span class="nx">ctx</span> <span class="o">*</span><span class="nx">gin</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="o">*</span><span class="nx">Response</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Response</span><span class="p">{</span><span class="nx">Ctx</span><span class="p">:</span> <span class="nx">ctx</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Response</span><span class="p">)</span> <span class="nf">ToResponse</span><span class="p">(</span><span class="nx">data</span> <span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">data</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">data</span> <span class="p">=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{}</span>
	<span class="p">}</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Response</span><span class="p">)</span> <span class="nf">ToResponseList</span><span class="p">(</span><span class="nx">list</span> <span class="kd">interface</span><span class="p">{},</span> <span class="nx">totalRows</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">r</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">,</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span>
		<span class="s">&#34;list&#34;</span><span class="p">:</span> <span class="nx">list</span><span class="p">,</span>
		<span class="s">&#34;pager&#34;</span><span class="p">:</span> <span class="nx">Pager</span><span class="p">{</span>
			<span class="nx">Page</span><span class="p">:</span>      <span class="nf">GetPage</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">),</span>
			<span class="nx">PageSize</span><span class="p">:</span>  <span class="nf">GetPageSize</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">),</span>
			<span class="nx">TotalRows</span><span class="p">:</span> <span class="nx">totalRows</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Response</span><span class="p">)</span> <span class="nf">ToErrorResponse</span><span class="p">(</span><span class="nx">err</span> <span class="o">*</span><span class="nx">errcode</span><span class="p">.</span><span class="nx">Error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">response</span> <span class="o">:=</span> <span class="nx">gin</span><span class="p">.</span><span class="nx">H</span><span class="p">{</span><span class="s">&#34;code&#34;</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Code</span><span class="p">(),</span> <span class="s">&#34;msg&#34;</span><span class="p">:</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Msg</span><span class="p">()}</span>
	<span class="nx">details</span> <span class="o">:=</span> <span class="nx">err</span><span class="p">.</span><span class="nf">Details</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">details</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
		<span class="nx">response</span><span class="p">[</span><span class="s">&#34;details&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="nx">details</span>
	<span class="p">}</span>

	<span class="nx">r</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">.</span><span class="nf">JSON</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">StatusCode</span><span class="p">(),</span> <span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-12-15&nbsp;<a class="git-hash" href="https://github.com/York-Shawn/blog/commit/a166db664139279d4e24071b5c0ef359a5315940" target="_blank" title="commit by Shawn(yorkshawn007@gmail.com) a166db664139279d4e24071b5c0ef359a5315940: complete gin-tutorial-2, modify avatar, fix comment count" rel="noopener noreferrer">
                                    <i class="fas fa-hashtag fa-fw"></i>a166db6</a></span>
            </div>
            <div class="post-info-license"><span><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/gin-tutorial-2/index.md" target="_blank" rel="noopener noreferrer">Read Markdown</a>
                        </span>|&nbsp;<span><a class="link-to-edit" href=https://github.com/York-Shawn/blog/tree/main/content/posts/Gin-Tutorial-2/index.md target="_blank" rel="noopener noreferrer">Edit this page</a>
                            </span></div>
            <div class="post-info-share">
                <span><a href="#" onclick="return false;" title="Share on Twitter" data-sharer="twitter" data-url="http://example.org/posts/gin-tutorial-2/" data-title="Gin-Tutorial-2" data-via="BigSnakeShawn" data-hashtags="Go,Backend"><i class="fab fa-twitter fa-fw"></i></a><a href="#" onclick="return false;" title="Share on Linkedin" data-sharer="linkedin" data-url="http://example.org/posts/gin-tutorial-2/"><i class="fab fa-linkedin fa-fw"></i></a><a href="#" onclick="return false;" title="Share on Reddit" data-sharer="reddit" data-url="http://example.org/posts/gin-tutorial-2/"><i class="fab fa-reddit fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/go/">Go</a>,&nbsp;<a href="/tags/backend/">Backend</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/gin-tutorial-3/" class="prev" rel="prev" title="Gin-Tutorial-3"><i class="fas fa-angle-left fa-fw"></i>Gin-Tutorial-3</a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.90.0">Hugo</a> | Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreffer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">Aya</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/fuse/fuse.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/topbar/topbar.min.js"></script><script type="text/javascript" src="/lib/pjax/pjax.min.js"></script><script type="text/javascript" src="/js/theme.min.js"></script></div>

<div class="pjax-assets"><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"data":{"desktop-header-typeit":"Aya","mobile-header-typeit":"Aya"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":true,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":30,"threshold":0.1,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/lightgallery/lightgallery.min.css">
    <noscript><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"></noscript></div>
</body>

</html>